<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>UMDS User Guide: UMDS Server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UMDS User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('umdsserver.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">UMDS Server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The UMDS Server is a daemon that enables UMDS Clients to exchange messages with standard Ultra Messaging sending and receiving applications. The following image shows some of the UMDS Server components and functionality.</p>
<div class="image">
<img src="UmdsServerOverview.png" alt="UmdsServerOverview.png"/>
</div>
 <p>The UMDS Server consists of the following components:</p>
<ul>
<li>
<p class="startli"><b>UMDS Server</b> - The UMDS Server is a daemon that contains a standard Ultra Messaging context, which sends and receives messages.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Workers</b> - Workers exchange messages with UMDS Client applications over TCP connections. You can configure and run multiple worker instances to provide parallelism.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Web Monitor</b> - Use the Web Monitor, a web-based user interface, to control operation of, and view the status of, the UMDS Server.</p>
<p class="endli"></p>
</li>
<li>
<b>Configuration Options</b> - When the umdsd UMDS Server starts, it reads configuration options from a umdsd configuration file. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="userauthentication"></a>
User Authentication&nbsp;&nbsp;<small><a href="#userauthentication">&lt;-</a></small></h1>
<p>You can assign a user or application name, or both, and a password, to authenticate your client applications or individual desktop users. Authentication occurs when a user or application requests a server connection.</p>
<p>You assign user passwords in the <code>&lt;user&gt;</code> element in the <a class="el" href="umdsserverconfiguration.html#basicauthenticationfile">Basic Authentication File</a>, which you specify in the <code>&lt;authentication&gt;</code> element in the <a class="el" href="umdsserverconfiguration.html#umdsdconfigurationfile">umdsd Configuration File</a>. You can specify an application or user name in the <a class="el" href="umdsserverconfiguration.html#umdsuserelement">UMDS user Element</a>. If you specify <code>&lt;none/&gt;</code> for the <code>&lt;authentication&gt;</code> element in the umdsd configuration file, the UMDS Server authenticates all applications and users.</p>
<p><br />
 </p>
<h1><a class="anchor" id="clientapplicationparameters"></a>
Client Application Parameters&nbsp;&nbsp;<small><a href="#clientapplicationparameters">&lt;-</a></small></h1>
<p>When a client application requests a server connection, the UMDS Server looks at a sequence of <code>&lt;client&gt;</code>element settings to determine what parameters to apply to the client application.</p>
<p>Operating parameters control the degree of resource utilization allowed by a client application, such as keep-alive intervals and thresholds. You can override all client application parameter values from multiple sources.</p>
<p>With overrides, you can select the optimal trade offs between flexibility and centralized control of client configuration. For example, a deployment that requires control would allow the client application to override fewer settings, which might simplify the job of the application programmer, but increase the responsibility of the server administrator.</p>
<p>UMDS Server factory defaults are the least restrictive, allowing clients to change any setting. However, you can configure a more restrictive, generic set of UMDS daemon <code>&lt;client&gt;</code>element settings that disable client overrides for certain settings. You can also set up acceptable ranges of values for other settings. Plus, you can then configure other applications or users to use different settings, which maybe more or less restrictive than the generic set of parameters.</p>
<p>The following table shows the sequence of <code>&lt;client&gt;</code>element settings the UMDS Server goes through when choosing the operating parameters for a particular UMDS Client application connection.</p>
<table class="doxtable">
<tr>
<th>Step </th><th>Client Settings Used by UMDS Server </th><th>Can Configure Parameters </th><th><p class="starttd">Can Authenticate User</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>1 </td><td><b>Factorydefaults.</b> Requires no action by either application programmers or UMDS Server administrator. </td><td>Yes </td><td><p class="starttd">No</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>2 </td><td><b>umdsdconfiguration file <code>&lt;client&gt;</code>element settings.</b> Overrides factory defaults. You can apply different settings to different UMDS Servers across the enterprise. </td><td>Yes </td><td><p class="starttd">No</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>3 </td><td><b>BasicAuthentication File <code>&lt;application&gt;</code>settings.</b> Overrides umdsd configuration file. These settings indicate one or more client applications that require different settings from the server settings in the umdsd configuration file. </td><td>Yes </td><td><p class="starttd">No</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd">4</p>
<p class="endtd"></p>
</td><td><b>BasicAuthentication File <code>&lt;user&gt;</code>settings.</b> Override Basic Authentication File <code>&lt;application&gt;</code>. These settings indicate one or more users that require either authentication or different operating parameters or both. </td><td>Yes </td><td><p class="starttd">Yes</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>5 </td><td><b>Clientapplication requests of certain settings.</b> umdsd configuration file and Basic Authentication File settings can deny the client application requests with the <code>client-write</code>attribute for any operation parameter. </td><td>Yes </td><td>No </td></tr>
</table>
<p>The UMDS Server sends the resulting settings to the client application as the final phase of the initial connection handshake.</p>
<dl class="section note"><dt>Note</dt><dd>For Steps 3 and 4, if you specify no Basic Authentication File and the client application does not provide a password, the UMDS Server permits the connection. However, the UMDS Server does not apply any <code>&lt;application&gt;</code>or <code>&lt;user&gt;</code>settings requested by the client application.</dd></dl>
<p><br />
 </p>
<h1><a class="anchor" id="keepalivetimersduringidleperiods"></a>
Keep Alive Timers During Idle Periods&nbsp;&nbsp;<small><a href="#keepalivetimersduringidleperiods">&lt;-</a></small></h1>
<p>UMDS provides keep alive timers so during periods of message inactivity, servers and clients can be aware of any unresponsiveness. Both the server and client have a keep alive interval and threshold. You configure these timers in the <a class="el" href="umdsserverconfiguration.html#umdsxmlclient">UMDS Element "&lt;client&gt;"</a> of the umds configuration file.</p>
<ul>
<li>
<p class="startli">The interval defines the time period in milliseconds between keep alive messages sent from either a client or server to the other (<a class="el" href="umdsserverconfiguration.html#umdsxmlclientkainterval">UMDS Element "&lt;client-ka-interval&gt;"</a> and <a class="el" href="umdsserverconfiguration.html#umdsxmlserverkainterval">UMDS Element "&lt;server-ka-interval&gt;"</a>). When a client or server sends a data message or keep alive message, it resets the interval.</p>
<p class="endli"></p>
</li>
<li>
The threshold defines the timeout for message traffic from the server or client to the other (keep alive or otherwise). A timeout results in disconnection. (<a class="el" href="umdsserverconfiguration.html#umdsxmlclientkathreshold">UMDS Element "&lt;client-ka-threshold&gt;"</a> and <a class="el" href="umdsserverconfiguration.html#umdsxmlserverkathreshold">UMDS Element "&lt;server-ka-threshold&gt;"</a>). When a client or server receives a data message or keep alive message, it resets the threshold. </li>
</ul>
<p>The following figure shows the interaction of the interval and threshold configuration elements for a server when traffic from a client ceases.</p>
<div class="image">
<img src="UMDS_Server_KeepAlive_1.png" alt="UMDS_Server_KeepAlive_1.png"/>
</div>
 <ol>
<li>
<p class="startli">When the server sends a message (data or keepalive) to the client, it resets the <code>server-ka-interval</code>. During the period when the server sends no data messages to the client, at the end of the <code>server-ka-interval</code>, it sends a keepalive message and resets the <code>server-ka-interval</code>. It continues to send keepalive messages at the expiration of the <code>server-ka-interval</code> as long as the connection exists.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">When the server receives a message (data or keepalive) from the client, it resets the <code>server-ka-threshold</code>.</p>
<p class="endli"></p>
</li>
<li>
If the server receives no messages from the client, it disconnects the client when the <code>server-ka-threshold</code> timer expires. </li>
</ol>
<p>During periods of inactivity, the interval used by one side prevents the threshold from being reached on the other side. Therefore, there is a relationship between <code>client-ka-interval</code> and <code>server-ka-threshold</code> and also between <code>server-ka-interval</code> and <code>client-ka-threshold</code>. The interval should be less than the related threshold.</p>
<p><br />
 </p>
<h1><a class="anchor" id="messagequeue"></a>
Message Queue&nbsp;&nbsp;<small><a href="#messagequeue">&lt;-</a></small></h1>
<p>The UMDS Server maintains a default message queue for the messages that it forwards to UMDS Client receiving applications. Because connections to UMDS Client applications use receiver-paced TCP, the UMDS Server queues these messages to prevent loss from fast senders.</p>
<p>In the UMDS Server configuration file, you can configure the queue's age limit and size limit with the <code>&lt;server&gt;</code> element <code>msg-age-limit</code> and <code>msg-q-size-limit</code> attributes. The UMDS Server deletes messages that stay in the queue longer than the age limit. If the queue reaches the configured size limit, the UMDS Server deletes the oldest messages in the queue to make room for new messages.</p>
<dl class="section note"><dt>Note</dt><dd>When considering memory usage, be aware that when the UMDS Server creates sources and receivers, it also creates other buffers and caches. Examples include the topic Late Join message cache, and buffers created using the standard Ultra Messaging configuration options. Note also that when UMDS configuration files do not specify standard Ultra Messaging configuration options, these options use default values.</dd></dl>
<p><br />
 </p>
<h2><a class="anchor" id="pertopicmessagequeues"></a>
Per-Topic Message Queues&nbsp;&nbsp;<small><a href="#pertopicmessagequeues">&lt;-</a></small></h2>
<p>When the default queue reaches its size limit and a new message arrives, the UMDS Server deletes the oldest message. This might be undesirable if the oldest message is for a different topic than the newest message. The UMDS Server can also maintain per-topic message queues to address the possibility of message loss across topics when using the single default message queue. You can configure topics in the UMDS Server configuration file to use their own message queue or the default queue with the <code>&lt;topics&gt;</code> element. You can configure topics by pattern matching or explicit names. Each queue maintains its own statistics, which you can view in the Web Monitor Client Details page.</p>
<p><br />
 </p>
<h2><a class="anchor" id="configuringmessagequeuesize"></a>
Configuring Message Queue Size&nbsp;&nbsp;<small><a href="#configuringmessagequeuesize">&lt;-</a></small></h2>
<p>Use the following information and examples to determine the optimum settings for the <code>msg-q-size-limit</code> parameter, and to properly size the physical memory contained in the UMDS Server host machine.</p>
<p>n</p>
<h2><a class="anchor" id="approximatingperqueuememoryuse"></a>
Approximating Per-Queue Memory Use&nbsp;&nbsp;<small><a href="#approximatingperqueuememoryuse">&lt;-</a></small></h2>
<p>The <code>msg-q-size-limit</code> parameter sets the maximum number of message payload bytes that the UMDS Server allows before deleting older messages to make room for new messages. This limit does not include the Ultra Messaging overhead of approximately 900 bytes per message.</p>
<p>For example, if a message queue contains 2,000 25-byte messages, this total of 50,000 payload bytes does not exceed the <code>msg-q-size-limit</code> parameter default size of 1,048,576 bytes. However, with the overhead of 900 bytes, the queue actually uses 925 x 2,000 = 1,850,000 bytes.</p>
<p><br />
 </p>
<h2><a class="anchor" id="approximatingthenumberofmessagesperqueue"></a>
Approximating the Number of Messages Per Queue&nbsp;&nbsp;<small><a href="#approximatingthenumberofmessagesperqueue">&lt;-</a></small></h2>
<p>You can calculate the maximum number of messages that fit into a queue if you know the message payload size. For example, if all messages have a payload size of 25 bytes, then the default configuration of 1,048,576 bytes indicates that up to (1,048,576 / 25) = 41,943 messages can be enqueued.</p>
<p>When using individual topic queues, each UMDS Client has multiple queues. Thus, the total memory use is the sum of the memory use of all topic queues.</p>
<p><br />
 </p>
<h2><a class="anchor" id="calculatingoptimalqueuesizelimits"></a>
Calculating Optimal Queue Size Limits&nbsp;&nbsp;<small><a href="#calculatingoptimalqueuesizelimits">&lt;-</a></small></h2>
<p>If all connected clients are able to keep up with average message traffic, then the message queue consumes little or no memory. However, if a burst of high-rate traffic occurs, queues can fill up quickly as clients struggle to keep up. The following example demonstrates peak memory utilization.</p>
<ul>
<li>
<p class="startli">If each message contains 25 bytes of user data, and the default queue size limit is set to 1,048,576 bytes, then the queue can grow to contain 41,943 messages.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">If each 25-byte message consumes a total of 925 bytes including the UMDS overhead, a full queue consumes about 37 MB of memory.</p>
<p class="endli"></p>
</li>
<li>
If 80 client queues all fill to capacity, these queues collectively consume about 3 GB of memory. </li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="workerconfigurationguidelines"></a>
Worker Configuration Guidelines&nbsp;&nbsp;<small><a href="#workerconfigurationguidelines">&lt;-</a></small></h1>
<p>The default configuration of the UMDS Server assigns three workers to service all client connections. For each worker, four primary threads process data as follows:</p>
<ul>
<li>
<p class="startli"><b>One Client-to-Server Data Thread:</b> handles all data produced by all sending Clients</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>One Server-to-Client Data Thread:</b> handles all data dispatched to all receiving Clients</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Two Ultra Messaging Backbone Context Processing Threads:</b> shared by all workers</p>
<ul>
<li>
<p class="startli">UMS context worker thread processes all UMS streaming data from the Ultra Messaging Backbone, using UMS unicast and multicast transports.</p>
<p class="endli"></p>
</li>
<li>
MIM context worker thread sends MIM data from sending Clients to the Ultra Messaging Backbone. </li>
</ul>
</li>
</ul>
<p>Four additional threads handle low volume internal command and control. These threads require a small fraction of the processing done by the primary threads.</p>
<p><br />
 </p>
<h2><a class="anchor" id="increasingnumberofumdsworkers"></a>
Increasing Number of UMDS Workers&nbsp;&nbsp;<small><a href="#increasingnumberofumdsworkers">&lt;-</a></small></h2>
<p>For each additional worker configured, the number of Client to Server Data Threads and Server to Client Data Threads increases by one. For example, four workers will result in four Client to Server Data Threads and four Server to Client Data Threads. Regardless of the number of workers configured, UMDS uses only two Informatica High Speed Message Backbone Processing Threads and 4 additional low volume command and control threads.</p>
<p><br />
 </p>
<h2><a class="anchor" id="workerscpucoresandperformance"></a>
Workers CPU Cores and Performance&nbsp;&nbsp;<small><a href="#workerscpucoresandperformance">&lt;-</a></small></h2>
<p>Due to the number of primary threads as described above, increasing the number of workers does not necessarily increase performance if the number of CPU Cores is four or less. For systems with greater than four cores, set the number of workers so the number of primary threads never exceeds the number of CPU Cores. See the table below.</p>
<table class="doxtable">
<tr>
<th>Workers </th><th>Client to Server Threads </th><th>Server to Client Threads </th><th>Ultra Messaging Threads </th><th>Number of Primary Threads </th><th><p class="starttd">Number of CPU Cores Recommended</p>
<p class="endtd"></p>
</th></tr>
<tr>
<td>1 </td><td>1 </td><td>1 </td><td>2 </td><td>4 </td><td><p class="starttd">4 or less</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>2 </td><td>2 </td><td>2 </td><td>2 </td><td>6 </td><td><p class="starttd">6</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>3 </td><td>3 </td><td>3 </td><td>2 </td><td>8 </td><td><p class="starttd">8</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>4 </td><td>4 </td><td>4 </td><td>2 </td><td>10 </td><td>10 </td></tr>
</table>
<p>Proper performance analysis to determine the optimal configuration is recommended.</p>
<p><br />
 </p>
<h2><a class="anchor" id="workersversusclientload"></a>
Workers Versus Client Load&nbsp;&nbsp;<small><a href="#workersversusclientload">&lt;-</a></small></h2>
<p>Using multiple workers distributes work load among multiple threads. UMDS assigns each new client connection to a worker in round robin fashion. For the case of 1 worker, the single worker manages all client connections. If you configure two workers, then each worker services half the clients. Note, however, the following two limitations:</p>
<ul>
<li>
<p class="startli">The server does not perform any load balancing of clients. For example, if two workers are servicing three clients each, but one of the six clients produces and/or consumes all the data, that client's worker will not distribute any processing chores to the other worker.</p>
<p class="endli"></p>
</li>
<li>
UMDS assigns new clients to workers in a round-robin fashion without regard to the current load. If, for example, a number of clients are evenly distributed across the workers and then all the clients assigned to a single worker disconnect, the UMDS Server does not move any clients to the idle worker. In addition, new connections continue to be assigned in a round-robin fashion. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
</body>
</html>
